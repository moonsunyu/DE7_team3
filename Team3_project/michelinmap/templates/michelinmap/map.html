<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8"/>
	<title>Kakao 지도 시작하기</title>
</head>
<body>
	<div id="map" style="width:500px;height:400px;"></div>
    {{ restaurants|json_script:"restaurants-data" }}
	<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=f21e0fd8ad7461f15ea3b66e2834dc0c"></script>
	<script>
        var restaurants = JSON.parse(document.getElementById('restaurants-data').textContent);
        if (restaurants.length === 0) {
            alert("등록된 식당이 없습니다.");
        } else {
            var first = restaurants[0];
		    var mapContainer = document.getElementById('map'), // 지도를 표시할 div 
            mapOption = { 
                center: new kakao.maps.LatLng(first.latitude, first.longitude), // 지도의 중심좌표
                level: 3 // 지도의 확대 레벨
            };
            
            var map = new kakao.maps.Map(mapContainer, mapOption); // 지도를 생성합니다

        restaurants.forEach(function(r) {
            if (!r.latitude || !r.longitude) return;
            // 마커를 생성합니다
            var marker = new kakao.maps.Marker({
                // 마커가 표시될 위치입니다 
                position: new kakao.maps.LatLng(r.latitude, r.longitude),
                map: map
            });
            // 인포윈도우를 생성합니다
            var customOverlay = new kakao.maps.CustomOverlay({
                position: new kakao.maps.LatLng(r.latitude, r.longitude),
                content: "<div style='padding:2px 5px; background:#fff; border:1px solid #ccc; font-size:12px;'>" + r.name + "</div>",
                yAnchor: 2.8
            });
            customOverlay.setMap(map);
        });
    }
	</script>
</body>
</html>