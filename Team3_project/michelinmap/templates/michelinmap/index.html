<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>미슐랭 맛집 지도</title>
</head>
<body>
    <h1>미슐랭 맛집 지도</h1>

    <!-- 1️⃣ Form -->
    <form method="get" action="{% url 'michelinmap:index' %}">
        <!-- Region 선택 -->
        <select id="region-select">
            <option value="" disabled selected style="color:#999;">시/도 선택</option>
            {% for region in regions %}
                <option value="{{ region.id }}">{{ region.r_name }}</option>
            {% endfor %}
        </select>

        <!-- City 선택 -->
        <select name="city_id" id="city-select">
            <option value="" disabled selected style="color:#999;">시/군/구 선택</option>
            {% for city in cities %}
                <option value="{{ city.id }}" {% if selected_city_id == city.id %}selected{% endif %}>
                    {{ city.c_name }}
                </option>
            {% endfor %}
        </select>

        <button type="submit">검색</button>
    </form>

    <iframe 
        src="{% url 'michelinmap:map' %}" 
        width="100%" 
        height="600px" 
        style="border:none;">
    </iframe>

    <!-- 2️⃣ 레스토랑 리스트 -->
    <ul>
        {% if restaurants %}
            {% for r in restaurants %}
                <li>{{ r.name }} - {{ r.address }}</li>
            {% endfor %}
        {% else %}
            <li>등록된 식당이 없습니다.</li>
        {% endif %}
    </ul>

    <!-- 3️⃣ JS: Region 선택 시 city 드롭다운 갱신 -->
    {{ cities|json_script:"cities-data" }}
    <script>
        var allCities = JSON.parse(document.getElementById('cities-data').textContent);
        var regionSelect = document.getElementById('region-select');
        var citySelect = document.getElementById('city-select');

        regionSelect.addEventListener('change', function() {
            var selectedRegionId = parseInt(this.value);

            citySelect.innerHTML = '<option value="" disabled selected style="color:#999;">시/군/구 선택</option>';

            allCities.forEach(function(city) {
                if (city.region_id === selectedRegionId) {
                    var option = document.createElement('option');
                    option.value = city.id;
                    option.textContent = city.c_name;
                    citySelect.appendChild(option);
                }
            });
        });
    </script>
</body>
</html>