<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8"/>
	<title>미슐랭 지도</title>
	<style>
	    #map { width:60%; height:600px; }
	</style>
</head>
<body>
	<div id="map"></div>

	{{ restaurants|json_script:"restaurants-data" }}

	<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=f21e0fd8ad7461f15ea3b66e2834dc0c"></script>
	<script>
        // JSON 데이터 파싱
        var restaurants = JSON.parse(document.getElementById('restaurants-data').textContent);

        // 지도 중심 좌표
        var centerLatLng;
        var mapLevel;

        if (!restaurants || restaurants.length === 0) {
            // 검색 전 또는 결과 없음 → 서울 시청 중심, 확대 레벨 낮게
            centerLatLng = new kakao.maps.LatLng(37.5665, 126.9780);
            mapLevel = 7;
        } else {
            // 검색 결과 존재 → 첫 레스토랑 기준 중심, 확대 레벨 높게
            centerLatLng = new kakao.maps.LatLng(restaurants[0].latitude, restaurants[0].longitude);
            mapLevel = 3;
        }

        var map = new kakao.maps.Map(document.getElementById('map'), {
            center: centerLatLng,
            level: mapLevel
        });

        // 마커와 커스텀 오버레이 추가 (검색 결과 있을 때만)
        if (restaurants && restaurants.length > 0) {
            restaurants.forEach(function(r) {
                if (!r.latitude || !r.longitude) return;

                // 마커 생성
                var marker = new kakao.maps.Marker({
                    position: new kakao.maps.LatLng(r.latitude, r.longitude),
                    map: map
                });

                // 커스텀 오버레이 생성
                var overlay = new kakao.maps.CustomOverlay({
                    position: new kakao.maps.LatLng(r.latitude, r.longitude),
                    content: "<div style='padding:2px 5px; background:#fff; border:1px solid #ccc; font-size:12px;'>" + r.name + "</div>",
                    yAnchor: 2.8
                });
                overlay.setMap(map);
            });
        }
	</script>
</body>
</html>